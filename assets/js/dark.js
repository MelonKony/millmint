document.addEventListener("DOMContentLoaded", function () {
const dark_mode_btn = document.getElementById("dark_mode_btn");
const light_mode_btn = document.getElementById("light_mode_btn");
const themeIcon = document.getElementById("theme-icon");
const themeToggle = document.getElementById("theme-toggle");

// Define SVG icons with simplified auto icon
const icons = {
    light: `<svg viewBox='0 0 48.33984375 50.359375' direction='ltr' xmlns='http://www.w3.org/2000/svg' version='1.1'>
<g fill-rule='nonzero' transform='scale(1,-1) translate(0,-50.359375)'>
<path fill='currentColor' stroke='currentColor' fill-opacity='1.0' stroke-width='1.0' d='
    M 24.169921875,42.130859375
    C 25.09375,42.130859375 25.845703125,42.8828125 25.845703125,43.806640625
    C 25.845703125,44.73046875 25.09375,45.50390625 24.169921875,45.50390625
    C 23.24609375,45.50390625 22.494140625,44.73046875 22.494140625,43.806640625
    C 22.494140625,42.8828125 23.24609375,42.130859375 24.169921875,42.130859375
    Z
    M 9.796875,37.16796875
    C 10.44140625,36.501953125 11.537109375,36.501953125 12.181640625,37.16796875
    C 12.826171875,37.8125 12.826171875,38.908203125 12.181640625,39.552734375
    C 11.537109375,40.197265625 10.44140625,40.197265625 9.796875,39.552734375
    C 9.130859375,38.908203125 9.130859375,37.8125 9.796875,37.16796875
    Z
    M 36.158203125,37.16796875
    C 36.802734375,36.501953125 37.8984375,36.501953125 38.54296875,37.16796875
    C 39.208984375,37.8125 39.208984375,38.908203125 38.54296875,39.552734375
    C 37.8984375,40.197265625 36.802734375,40.197265625 36.158203125,39.552734375
    C 35.513671875,38.908203125 35.513671875,37.8125 36.158203125,37.16796875
    Z
    M 24.169921875,15.318359375
    C 29.5625,15.318359375 34.03125,19.787109375 34.03125,25.1796875
    C 34.03125,30.572265625 29.5625,35.01953125 24.169921875,35.01953125
    C 18.77734375,35.01953125 14.30859375,30.572265625 14.30859375,25.1796875
    C 14.30859375,19.787109375 18.77734375,15.318359375 24.169921875,15.318359375
    Z
    M 42.818359375,23.482421875
    C 43.7421875,23.482421875 44.494140625,24.255859375 44.494140625,25.1796875
    C 44.494140625,26.103515625 43.7421875,26.85546875 42.818359375,26.85546875
    C 41.89453125,26.85546875 41.12109375,26.103515625 41.12109375,25.1796875
    C 41.12109375,24.255859375 41.89453125,23.482421875 42.818359375,23.482421875
    Z
    M 5.521484375,23.482421875
    C 6.4453125,23.482421875 7.21875,24.255859375 7.21875,25.1796875
    C 7.21875,26.103515625 6.4453125,26.85546875 5.521484375,26.85546875
    C 4.59765625,26.85546875 3.845703125,26.103515625 3.845703125,25.1796875
    C 3.845703125,24.255859375 4.59765625,23.482421875 5.521484375,23.482421875
    Z
    M 36.158203125,10.78515625
    C 36.82421875,10.140625 37.8984375,10.140625 38.564453125,10.78515625
    C 39.208984375,11.451171875 39.208984375,12.525390625 38.564453125,13.19140625
    C 37.8984375,13.8359375 36.82421875,13.8359375 36.158203125,13.19140625
    C 35.513671875,12.525390625 35.513671875,11.451171875 36.158203125,10.78515625
    Z
    M 9.796875,10.78515625
    C 10.44140625,10.140625 11.537109375,10.140625 12.181640625,10.78515625
    C 12.826171875,11.451171875 12.826171875,12.525390625 12.181640625,13.169921875
    C 11.537109375,13.8359375 10.44140625,13.8359375 9.796875,13.169921875
    C 9.130859375,12.525390625 9.130859375,11.451171875 9.796875,10.78515625
    Z
    M 24.169921875,4.85546875
    C 25.09375,4.85546875 25.845703125,5.607421875 25.845703125,6.53125
    C 25.845703125,7.455078125 25.09375,8.20703125 24.169921875,8.20703125
    C 23.24609375,8.20703125 22.494140625,7.455078125 22.494140625,6.53125
    C 22.494140625,5.607421875 23.24609375,4.85546875 24.169921875,4.85546875
    Z
' />
</g>
</svg>`,
    dark: `<svg viewBox='0 0 47.201171875 48.16796875' direction='ltr' xmlns='http://www.w3.org/2000/svg' version='1.1'>
<g fill-rule='nonzero' transform='scale(1,-1) translate(0,-48.16796875)'>
<path fill='currentColor' stroke='currentColor' fill-opacity='1.0' stroke-width='1.0' d='
    M 34.654296875,16.2421875
    C 23.740234375,16.2421875 15.919921875,24.0625 15.919921875,35.01953125
    C 15.919921875,38.349609375 16.2421875,40.4765625 17.166015625,42.625
    C 17.23046875,42.775390625 17.2734375,42.947265625 17.2734375,43.076171875
    C 17.2734375,43.5703125 16.88671875,43.935546875 16.4140625,43.935546875
    C 16.28515625,43.935546875 16.15625,43.9140625 16.02734375,43.87109375
    C 8.80859375,40.734375 3.845703125,32.828125 3.845703125,24.44921875
    C 3.845703125,13.169921875 12.783203125,4.232421875 24.10546875,4.232421875
    C 32.44140625,4.232421875 40.734375,9.388671875 43.3125,16.15625
    C 43.35546875,16.28515625 43.35546875,16.4140625 43.35546875,16.54296875
    C 43.35546875,17.05859375 43.01171875,17.466796875 42.49609375,17.466796875
    C 42.41015625,17.466796875 42.345703125,17.4453125 42.23828125,17.423828125
    C 40.60546875,16.908203125 37.640625,16.2421875 34.654296875,16.2421875
    Z
' />
</g>
</svg>`,
    auto: `<svg viewBox='0 0 47.05078125 62.69140625' direction='ltr' xmlns='http://www.w3.org/2000/svg' version='1.1'>
<g fill-rule='nonzero' transform='scale(1,-1) translate(0,-62.69140625)'>
<path fill='currentColor' stroke='currentColor' fill-opacity='1.0' stroke-width='1.0' d='
    M 22.408203125,45.697265625
    C 22.494140625,45.697265625 22.537109375,45.71875 22.580078125,45.826171875
    C 23.07421875,49.564453125 23.224609375,49.84375 27.177734375,50.466796875
    C 27.328125,50.509765625 27.37109375,50.552734375 27.37109375,50.66015625
    C 27.37109375,50.767578125 27.328125,50.83203125 27.177734375,50.853515625
    C 23.267578125,51.6484375 23.482421875,51.927734375 22.580078125,55.494140625
    C 22.537109375,55.6015625 22.494140625,55.623046875 22.408203125,55.623046875
    C 22.34375,55.623046875 22.279296875,55.6015625 22.2578125,55.494140625
    C 21.35546875,51.927734375 21.65625,51.6484375 17.638671875,50.853515625
    C 17.509765625,50.83203125 17.466796875,50.767578125 17.466796875,50.66015625
    C 17.466796875,50.552734375 17.509765625,50.509765625 17.638671875,50.466796875
    C 21.65625,49.671875 21.69921875,49.564453125 22.2578125,45.826171875
    C 22.279296875,45.71875 22.34375,45.697265625 22.408203125,45.697265625
    Z
    M 11.623046875,31.388671875
    C 11.7734375,31.388671875 11.859375,31.474609375 11.90234375,31.646484375
    C 12.869140625,37.42578125 12.783203125,37.2109375 18.6484375,38.37109375
    C 18.77734375,38.4140625 18.884765625,38.478515625 18.884765625,38.650390625
    C 18.884765625,38.80078125 18.77734375,38.88671875 18.6484375,38.908203125
    C 12.783203125,40.08984375 12.869140625,39.875 11.90234375,45.654296875
    C 11.859375,45.826171875 11.7734375,45.890625 11.623046875,45.890625
    C 11.494140625,45.890625 11.38671875,45.826171875 11.365234375,45.654296875
    C 10.3984375,39.896484375 10.5703125,40.08984375 4.619140625,38.908203125
    C 4.490234375,38.88671875 4.3828125,38.80078125 4.3828125,38.650390625
    C 4.3828125,38.478515625 4.490234375,38.4140625 4.619140625,38.37109375
    C 10.5703125,37.189453125 10.3984375,37.404296875 11.365234375,31.646484375
    C 11.38671875,31.474609375 11.494140625,31.388671875 11.623046875,31.388671875
    Z
    M 26.189453125,7.068359375
    C 26.576171875,7.068359375 26.791015625,7.3046875 26.8125,7.60546875
    C 28.015625,20.990234375 29.240234375,21.849609375 42.130859375,22.923828125
    C 42.453125,22.9453125 42.66796875,23.16015625 42.66796875,23.482421875
    C 42.66796875,23.8046875 42.453125,24.01953125 42.130859375,24.041015625
    C 29.240234375,25.115234375 28.015625,25.974609375 26.8125,39.359375
    C 26.791015625,39.66015625 26.576171875,39.896484375 26.189453125,39.896484375
    C 25.802734375,39.896484375 25.587890625,39.66015625 25.56640625,39.359375
    C 24.36328125,25.974609375 23.138671875,25.115234375 10.26953125,24.041015625
    C 9.92578125,24.01953125 9.7109375,23.8046875 9.7109375,23.482421875
    C 9.7109375,23.16015625 9.92578125,22.9453125 10.26953125,22.923828125
    C 23.095703125,21.3984375 24.169921875,20.96875 25.56640625,7.60546875
    C 25.587890625,7.3046875 25.802734375,7.068359375 26.189453125,7.068359375
    Z
' />
</g>
</svg>
`
};

const themes = ["light", "dark", "auto"];
let currentTheme = localStorage.getItem("theme") || "auto";

    function applySystemTheme() {
        const isSystemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        document.documentElement.setAttribute("data-theme", isSystemDark ? "dark" : "light");
        updateButtonVisibility(isSystemDark ? "dark" : "light");
        updateThemeIcon("auto");
        colorsMain();
    }

    // Add near the top of the file
    function setScheme(theme) {
        // Remove ready class during transition
        document.documentElement.classList.remove('ready');
        
        if (theme === "auto") {
            localStorage.theme = "auto";
            applySystemTheme();
        } else {
            document.documentElement.setAttribute("data-theme", theme);
            localStorage.theme = theme;
            updateButtonVisibility(theme);
            updateThemeIcon(theme);
        }
        colorsMain();
        
        // Add ready class back after a brief delay
        setTimeout(() => {
            document.documentElement.classList.add('ready');
        }, 50);
    }

    function updateButtonVisibility(theme) {
        if (dark_mode_btn && light_mode_btn) {
            if (theme === "dark") {
                dark_mode_btn.classList.add('hidden');
                light_mode_btn.classList.remove('hidden');
            } else {
                light_mode_btn.classList.add('hidden');
                dark_mode_btn.classList.remove('hidden');
            }
        }
    }

    function updateThemeIcon(theme) {
        themeIcon.innerHTML = icons[theme];
    }

    function initTheme() {
        if (currentTheme === "auto") {
            applySystemTheme();
        } else {
            setScheme(currentTheme);
        }
    }

    themeToggle.addEventListener('click', () => {
        const nextTheme = themes[(themes.indexOf(currentTheme) + 1) % themes.length];
        currentTheme = nextTheme;
        setScheme(nextTheme);
    });

    const systemThemeQuery = window.matchMedia('(prefers-color-scheme: dark)');
    systemThemeQuery.addEventListener('change', event => {
        if (localStorage.theme === 'auto') {
            applySystemTheme();
        }
    });

    initTheme();
});