{{/* Fixed css.html with proper resource handling */}}
{{- $core := resources.Get "scss/core.scss" -}}

{{- /* Generate icons SCSS content */ -}}
{{- $iconsContent := partial "resources/icons.html" . -}}
{{- $iconsResource := resources.FromString "scss/_icons.scss" $iconsContent -}}

{{- /* Combine the resources */ -}}
{{- $combinedContent := printf "%s\n\n%s" $iconsContent $core.Content -}}
{{- $combined := resources.FromString "scss/combined.scss" $combinedContent -}}

{{- /* Process SCSS to CSS */ -}}
{{- $styles := "" -}}
{{- if hugo.IsProduction -}}
  {{- $tocss_opts := dict "targetPath" "css/style.css" "outputStyle" "compressed" "enableSourceMap" true -}}
  {{- $styles = $combined | resources.ToCSS $tocss_opts | resources.Minify | resources.Fingerprint "sha512" -}}
{{- else -}}
  {{- $tocss_opts := dict "targetPath" "css/style.css" "outputStyle" "expanded" "enableSourceMap" true -}}
  {{- $styles = $combined | resources.ToCSS $tocss_opts -}}
{{- end -}}

<link rel="stylesheet" href="{{ $styles.RelPermalink }}"{{ if $styles.Data.Integrity }} integrity="{{ $styles.Data.Integrity }}"{{ end }}>

{{/* Prism.js style */}}
{{- if or (and (findRE "<pre" .Content 1) (eq (.Scratch.Get "params").syntax_highlight.lib "prism.js")) (.HasShortcode "emgithub") -}}
    {{- $prism_css := resources.Get "lib/css/prism.css" -}}
    {{- if hugo.IsProduction -}}
        {{- $prism_css = $prism_css | resources.Minify | resources.Fingerprint "sha512" -}}
    {{- end -}}
    <link rel="stylesheet" href="{{ $prism_css.RelPermalink }}"{{ if $prism_css.Data.Integrity }} integrity="{{ $prism_css.Data.Integrity }}"{{ end }}>
{{- end -}}