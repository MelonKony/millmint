{{- partial "params.html" . -}}

<!DOCTYPE html>
<html lang='{{ .Site.LanguageCode }}'>
{{- partial "head.html" . -}}
<!-- Leaflet CSS and JS -->
<!-- Keep only these in the head section -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<!-- Replace the existing fullscreen CSS/JS links with these -->
<link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css' rel='stylesheet' />
<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>

<body {{if .Params.Color }}data-color="{{ .Params.Color }}" {{ end }} class="show-all-images">
  <main>
    <div class="nav">
      {{- partial "header.html" . -}}
      {{- partial "nav.html" . -}}
    </div>

    <div id="map-container">
      <div id="map-loading">Loading map...</div>
      <div id="map" style="width: 100%; height: 75vh;"></div>
    </div>
  </main>
  {{- partial "resources/js.html" . -}}
  {{- partial "script.html" . -}}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mapLoading = document.getElementById('map-loading');
            
            // Get the image path from the page parameters or use a default
            const imagePath = {{ if .Params.map }}{{ printf "%q" .Params.map | safeJS }}{{ else }}"/svg/maps/world.png"{{ end }};
            
            // Create map instance with better options
            const map = L.map('map', {
                crs: L.CRS.Simple,
                minZoom: -3,
                maxZoom: 2,
                zoomControl: false,  // Disable default zoom controls
                attributionControl: false
            });

            // Load the image
            const img = new Image();
            img.onload = function() {
                const w = this.width;
                const h = this.height;
                const bounds = [[0, 0], [h, w]];
                
                L.imageOverlay(imagePath, bounds).addTo(map);
                map.fitBounds(bounds);
                
                // Add zoom controls in bottom right
                L.control.zoom({
                    position: 'bottomright'
                }).addTo(map);
                
                // Add fullscreen control
                L.control.fullscreen({
                    position: 'bottomright',
                    title: 'Toggle fullscreen',
                    forceSeparateButton: true
                }).addTo(map);
                
                // Hide loading message
                mapLoading.style.display = 'none';
            };
            
            img.onerror = function() {
                mapLoading.textContent = 'Error loading map image. Please check the path.';
                mapLoading.style.color = 'red';
            };
            
            img.src = imagePath;
        });
    </script>
    
    <style>
        #map-container {
            position: relative;
            width: 100%;
            height: 75vh;
            padding: 0;
        }
        
        #map {
            width: 100%;
            height: 75vh;  /* Match the container height */
            background: rgb(232, 242, 250);
            border-radius: 0.25rem;
        }
        
        [data-theme="dark"] #map {
            background: rgba(18, 18, 25, 1);
        }
        
        [data-theme="dark"] .leaflet-image-layer {
            filter: invert(1) hue-rotate(180deg);
        }
        
        #map-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.8);
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
    </style>
</body>